---
title: "Types of error bars and it's differences"
author: "Elena U"
date: "2022-11-15"
output: html_document
---

```{css, echo=FALSE}
.spoiler {
  visibility: hidden;
}

.spoiler::before {
  background-color: #d6d6d6;
  visibility: visible;
  content: "Spoiler alert! Не открывайте, если не уверены, что хотите это знать."
}

.spoiler:hover {
  visibility: visible;
}

.spoiler:hover::before {
  display: none;
}
```

Сегодня поговорим о различных видах пределов погрешностей или усов, как пишут в русскоязычной литературе (error bars).

*Предупреждаю сразу: по ходу повествования я буду использовать все варианты написания этого термина, даже слово эррор бар.*


Важно отметить, что существует два принципиально разных вида отображения пределов погрешностей на графике: 

* отражение описательных статистик (descriptive statistics);
* отражение статистик вывода (inferential statistics). 

Они выглядят на графике одинаково, но по факту фундаментально различны.
Давайте разбираться, в чем разница.

## Descriptive error bars

К описательным эррор барам относятся:

* Размах (range): разница между максимальным и минимальным значением в выборке (X~max~ - X~min~).
* Межквартильный размах (interquartile range, IQR): разница между третьм квартилем (Q~3~) и первым квартилем (Q~1~.).
* Стандартное отклонение (standard deviation, sd): квадратный корень из дисперсии.

**Размах** самая простая для понимания метрика, при этом редко использующаяся, поскольку сама по себе разница между максимальным и минимальным значением довольно-таки малоинформативна.

**Межквартильный размах (IQR)**, точнее 1.5\*IQR чаще всего используется на боксплотах (boxplot), я не встречала 1\*IQR или 1.5\*IQR как усы к обычным барплотам, но мало ли что может встретиться.

![*Самое простое описание составляющих боксплота*](boxplot.png)

Если расставить числа в ряд по возрастанию, то середина этого ряда - медиана (median) или второй квартиль (Q~2~). Первый квартиль (Q~1~) - значение, меньше которого 25% процентов данных, третий квартиль (Q~3~) - значение, меньше которого 75% данных.

Думаю, что на рисунке понять проще:

![*про межквартильный размах (IQR)*](figures/IQR.png){width=75%}

Межквартильный размах намного чаще используется для визуализации, так как предоставляет больше информации о данных.

**Стандартное отклонение (standard deviation)** по-моему наиболее часто встречается в публикациях и на конференциях (по крайней мере в биологии), да и я обычно использую именно sd в качестве предела погрешностей.

Нарисовала небольшую схему про стандартное отклонение. Пока не сделала с детальным вычислением на реальных данных, поэтому пример пример можно посмотреть на [статквесте](https://www.youtube.com/watch?v=SzZ6GpcfoQY).

![Про sd. А еще я думала у меня нормальный почерк...](figures/sd.png)


Важный момент! Все вышеописанные метрики отражают разброс значений в нашей **выборке**, без каких-либо предположений о происходящем в генеральной совокупности. В этом отличие от второго типа error bar.

## Inferential error bars

К эррор барам, отражающим статистики вывода относятся:

* Стандартная ошибка среднего (standard error, se)
* Доверительный интервал (confidence interval, CI)

Принципиальное отличие от описательных пределов погрешности в том, что грубо говоря, стандартная ошибка среднего/доверительный интервал пытаются отразить степень уверенности в поиске *истинного среднего* генеральной совокупности. В то время как описательные отражают, что происходит конкретно в *нашей выборке*.

Тут немного инфы для продвинутых:

[Небольшое уточнение: с помощью бутстрепов можно оценивать не только доверительный интервал и стандартную ошибку для среднего, но и для медианы и даже для стандартного отклонения, но про это сейчас не будем]{.spoiler}


### Стандартная ошибка среднего
Теперь еще немного вымученных формулировок, которые попробую сформулировать понятнее.

Вымученная формулировка:
*The standard error (SE) of a statistic is the standard deviation of its sampling distribution or an estimate of that standard deviation.* (цитата прямо из [википедии](https://en.wikipedia.org/wiki/Standard_error))


Формула вычисления стандартной ошибки среднего очень простая - стандартное отклонение, деленное на квадратный корень из размера выборки. Но что на самом деле это значит, какой физический смысл стоит за результатом этого вычисления? Попробуйте сами ответить на этот вопрос, опираясь только на определение из википедии и формулу)

Теперь попробуем представить, что мы провели некий эксперимент, например измеряли вес 20 мышей после какого-либо воздействия и усредняли полученные значения. При этом мы решили 10 раз повторить свой эксперимент, в результате чего получили 10 средних значений. После этого мы можем посчитать среднее средних (!) и **стандартное отклонение средних**. Вот это стандартное отклонение выборочных средних и есть стандартная ошибка среднего. Ура? Пойду воспроизводить эксперимент по 10 раз?

Но мы не всегда (обычно никогда) можем себе позволить повторять эксперимент по 10 раз, и хитрость в том, что мы можем вычислить стандартную ошибку среднего без многократного повторения эксперимента, просто поделив стандартное отклонение на квадратный корень из размера выборки. 

Вот [тут](https://pozdniakov.github.io/tidy_stats/310-infer_stats.html#sec-sample_dist) хорошо расписано, как моделировать стандартную ошибку средних и что она действительно соответствует стандартному отклонению, деленному на квадратный корень из числа наблюдений.


![*Формула SE (стандартной ошибки), где сигма это стандартное отклонение, n - количество наблюдений*](figures/standard_error.svg)

В [статье](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2064100/), на которую я опиралась при написании этого материала, было указано, что для представления сравнения групп лучше использовать стандартную ошибку/доверительный интервал как error bar.

Но у меня есть неприятное подозрение, что для публикаций и представлений своей работы на конференциях некоторые недобросовестные ученые используют se, чтобы на графиках были усы поменьше. Однако, я не хочу обидеть всех, кто использует стандартную ошибку и понимает физический смысл. Интересно будет собрать примеры работ, где использование se оправданно и разумно, и где это не так, поэтому если есть примеры, то пишите в комментарии.

В целом, плюс именно se в том, что при отрисовке сравнений двух или нескольких групп, перекрываемость усов позволяет косвенно судить о значимости различий, в то время как sd и остальные описательные пределы погрешностей - нет. Однако sd показывает данные почти как они есть, то есть реальный разброс в наших данных, без предположений о генеральной совокупности, поэтому лично я предпочитаю sd для отрисовки. Это тоже интересная тема для дискуссии, буду рада обсудить в комментариях.

И наконец...

### Доверительный интервал

отражают диапазон в котором мы можем ожидать истинное значение среднего, в то время как стандартное отклонение отражает по сути меру разброса в наших данных. Схожая идея при отражении размаха или межквартильного размаха. 







